---
title: "RWorksheet5_(Celestra, Caneso, Arenal)"
output: pdf_document
date: "2024-11-06"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**1.**
```{r}

```
**________________________________________________________**

*IMDB URL*
```{r}
library(rvest)
library(httr)
library(polite)

polite::use_manners(save_as = 'polite_scrape.R')

url <- "https://www.imdb.com/chart/toptv/?ref_=nv_tvv_250"

session <- bow(url,
user_agent = "Educational")
session

```

*Title List*
```{r}
title_list <- scrape(session) %>%
html_nodes('h3.ipc-title__text') %>%
html_text

title_list_sub <- as.data.frame(title_list[2:26])
title_list_sub
```

*Split*
```{r}
colnames(title_list_sub) <- "ranks"

split_df <- strsplit(as.character(title_list_sub$ranks),".",fixed = T)
split_df <- data.frame(do.call(rbind,split_df))

colnames(split_df) <- c("ranks", "titles")
split_df
```

*Rating*
```{r}
rating_list <- scrape(session) %>%
html_nodes('span.ipc-rating-star--rating') %>%
html_text

rating_list_sub <- as.data.frame(rating_list[1:25])
colnames(rating_list_sub) <- "ratings"

```

*Number of People who voted*
```{r}
people_list <- scrape(session) %>%
html_nodes('span.ipc-rating-star--voteCount') %>%
html_text

people_list_sub <- as.data.frame(people_list[1:25])


colnames(people_list_sub) <- "Vote Count"
```

*Episode and Year it was released*
```{r}
episode_list <- scrape(session) %>%
html_nodes('span.sc-5bc66c50-6.OOdsw.cli-title-metadata-item:nth-of-type(2)') %>%
html_text

episode_list_sub <-as.data.frame(episode_list[1:25])

colnames(episode_list_sub) <- "episode"


year_list <- scrape(session) %>%
html_nodes('span.sc-5bc66c50-6.OOdsw.cli-title-metadata-item:nth-of-type(1)') %>%
html_text
year_list_sub <-as.data.frame(year_list[1:25])
colnames(year_list_sub) <- "year"

```

**User Reviews**
```{r}
library(rvest)
library(dplyr)

home_link <- 'https://www.imdb.com/chart/toptv/'
main_page <- read_html(home_link)

# Extract links to individual TV show pages
links <- main_page %>%
  html_nodes("a.ipc-title-link-wrapper") %>%
  html_attr("href")

# Ensure we have links
if(length(links) == 0) {
  stop("No links found")
}

# Loop through each show page and extract relevant data
show_data <- lapply(links, function(link) {
  complete_link <- paste0("https://imdb.com", link)
  
  # Get the show's page
  usrv_link <- tryCatch({
    read_html(complete_link)
  }, error = function(e) {
    return(NULL)  # If there's an error, return NULL
  })
  
  # If the show page wasn't loaded successfully, skip to the next iteration
  if (is.null(usrv_link)) return(NULL)

  # Extract user review page link (if exists)
  usrv_link_page <- usrv_link %>%
    html_nodes('a.isReview') %>%
    html_attr("href")
  
  # Check if the user review link exists
  if (length(usrv_link_page) == 0) {
    usrv_link_page <- NA
  } else {
    usrv_link_page <- usrv_link_page[1]
  }

  # Extract critic reviews (if they exist)
  critic <- usrv_link %>%
    html_nodes("span.score") %>%
    html_text()
  
  # Handle case where there may be no critic reviews
  critic_review <- if(length(critic) >= 2) critic[2] else NA
  critic_df <- data.frame(Critic_Reviews = critic_review, stringsAsFactors = FALSE)
  
  # Extract popularity rating (if it exists)
  pop_rating <- usrv_link %>%
    html_nodes('[data-testid="hero-rating-bar__popularity__score"]') %>%
    html_text()
  
  # Handle missing popularity rating
  pop_rating <- if(length(pop_rating) > 0) pop_rating else NA
  
  # If a user review link exists, extract the user review count
  usrv_count <- NA
  if (!is.na(usrv_link_page)) {
    usrv_page <- tryCatch({
      read_html(paste0("https://imdb.com", usrv_link_page))
    }, error = function(e) {
      return(NULL)  # If user review page fails to load
    })
    
    # If user review page loads, extract review count
    if (!is.null(usrv_page)) {
      usrv_count <- usrv_page %>%
        html_nodes('[data-testid="tturv-total-reviews"]') %>%
        html_text()
    }
  }

  # Return a data frame with the extracted data
  return(data.frame(Show_Link = complete_link, 
                    User_Reviews = usrv_count, 
                    Critic = critic_df$Critic_Reviews, 
                    Popularity_Rating = pop_rating, 
                    stringsAsFactors = FALSE))
})

# Combine all show data into a single data frame (ignoring NULL values)
show_data <- bind_rows(show_data)

# View the first few rows
head(show_data)

```

**________________________________________________________**
```{r}

```



**2.**
```{r}

```









*Final List*
```{r}
tv_shows <- cbind(split_df, rating_list_sub, people_list_sub,episode_list_sub, year_list_sub)
tv_shows

```


